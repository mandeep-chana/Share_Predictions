
            <!DOCTYPE html>
            <html>
            <head>
                <title>Real-time Stock Chart</title>
                <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                <style>
                    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f0f0; }
                    #chart { background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
                    #debug-panel { margin-top: 10px; padding: 10px; background-color: white; border-radius: 5px; }
                    .status { margin: 10px 0; padding: 10px; background-color: white; border-radius: 5px; }
                </style>
            </head>
            <body>
                <h2>Real-time Stock Chart for <span id="ticker">Loading...</span></h2>
                <div class="status">
                    Connection Status: <span id="connection-status">Connecting...</span>
                    <button onclick="toggleDebug()">Toggle Debug</button>
                </div>
                <div id="chart"></div>
                <div id="debug-panel"></div>

                <script>
                    // Debug functionality
                    function debugLog(message) {
                        console.log(message);
                        const debugPanel = document.getElementById('debug-panel');
                        const timestamp = new Date().toISOString();
                        debugPanel.innerHTML = `${timestamp}: ${message}<br>` + debugPanel.innerHTML;
                    }

                    function toggleDebug() {
                        const debugPanel = document.getElementById('debug-panel');
                        debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
                    }

                    const ws = new WebSocket('ws://localhost:8765');
                    let trace = {
                        x: [],
                        open: [],
                        high: [],
                        low: [],
                        close: [],
                        type: 'candlestick',
                        xaxis: 'x',
                        yaxis: 'y'
                    };

                    let layout = {
                        title: 'Real-time Candlestick Chart',
                        xaxis: { 
                            title: 'Time',
                            rangeslider: {visible: false},
                            type: 'date',
                            tickformat: '%H:%M:%S'
                        },
                        yaxis: { 
                            title: 'Price',
                            autorange: true
                        },
                        plot_bgcolor: 'white',
                        paper_bgcolor: 'white'
                    };

                    Plotly.newPlot('chart', [trace], layout);

                    ws.onopen = function() {
                        debugLog('WebSocket Connected');
                        document.getElementById('connection-status').textContent = 'Connected';
                        document.getElementById('connection-status').style.color = 'green';
                    };

                    ws.onclose = function() {
                        debugLog('WebSocket Disconnected');
                        document.getElementById('connection-status').textContent = 'Disconnected';
                        document.getElementById('connection-status').style.color = 'red';
                    };

                    ws.onmessage = function(event) {
                        try {
                            debugLog('Received message: ' + event.data);
                            const data = JSON.parse(event.data);

                            if (data.symbol) {
                                document.getElementById('ticker').textContent = data.symbol;
                            }

                            if (data.candlestick) {
                                debugLog('Processing candlestick: ' + JSON.stringify(data.candlestick));

                                const timestamp = new Date(data.candlestick.timestamp);
                                trace.x.push(timestamp);
                                trace.open.push(data.candlestick.open);
                                trace.high.push(data.candlestick.high);
                                trace.low.push(data.candlestick.low);
                                trace.close.push(data.candlestick.close);

                                debugLog(`Added point: Time=${timestamp.toLocaleTimeString()}, O=${data.candlestick.open}, H=${data.candlestick.high}, L=${data.candlestick.low}, C=${data.candlestick.close}`);

                                // Update the chart
                                Plotly.update('chart', {
                                    x: [trace.x],
                                    open: [trace.open],
                                    high: [trace.high],
                                    low: [trace.low],
                                    close: [trace.close]
                                }).then(() => {
                                    debugLog('Chart updated successfully');
                                }).catch(error => {
                                    debugLog('Error updating chart: ' + error);
                                });
                            }
                        } catch (error) {
                            debugLog('Error processing message: ' + error);
                        }
                    };

                    // Auto-scroll functionality
                    setInterval(function() {
                        if (trace.x.length > 0) {
                            const now = new Date();
                            const thirtyMinutesAgo = new Date(now - 30 * 60 * 1000);

                            Plotly.relayout('chart', {
                                'xaxis.range': [thirtyMinutesAgo, now]
                            }).catch(error => {
                                debugLog('Error updating range: ' + error);
                            });
                        }
                    }, 1000);
                </script>
            </body>
            </html>
            